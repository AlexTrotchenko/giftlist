{"id":"giftlist-23f","title":"User Sync Webhook","description":"Sync Clerk users to D1 on auth events.\n\n## Steps\n- Install svix for webhook signature verification\n- Create /api/webhooks/clerk endpoint using auth adapter\n- Handle events: user.created, user.updated, user.deleted\n- Insert/update/delete from users table\n- Add CLERK_WEBHOOK_SECRET to environment\n\n## Files\n- src/pages/api/webhooks/clerk.ts (create - uses auth adapter)\n\n## Clerk Dashboard Config (do after deploy)\n- Endpoint: https://\u003cdomain\u003e/api/webhooks/clerk\n- Events: user.created, user.updated, user.deleted\n\n## Dependencies\n- Requires: Database Migration, Clerk Integration","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T20:21:33.563455-08:00","created_by":"alex","updated_at":"2025-12-29T20:21:33.563455-08:00","dependencies":[{"issue_id":"giftlist-23f","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.159424-08:00","created_by":"daemon"},{"issue_id":"giftlist-23f","depends_on_id":"giftlist-vfk","type":"blocks","created_at":"2025-12-29T20:22:55.38982-08:00","created_by":"daemon"},{"issue_id":"giftlist-23f","depends_on_id":"giftlist-hvy","type":"blocks","created_at":"2025-12-29T20:22:55.415829-08:00","created_by":"daemon"}]}
{"id":"giftlist-4bn","title":"Personal Wishlist MVP","description":"Create a working vertical slice where users can authenticate and manage their personal wishlist. No sharing, groups, or claims - just the foundation.\n\n## Scope\n- User authentication via Clerk (with adapter pattern for future swap)\n- Database with users and items tables (Drizzle + D1)\n- CRUD operations for wishlist items\n- Basic authenticated UI layout\n- Route: /wishlist\n\n## Out of Scope (Future Epics)\n- Groups and invitations\n- Tagging items with recipients  \n- Claiming items\n- Notifications\n- Image upload to R2","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-29T20:19:46.445094-08:00","created_by":"alex","updated_at":"2025-12-29T20:20:09.104443-08:00"}
{"id":"giftlist-5d3","title":"Database Foundation","description":"Set up Drizzle ORM with Cloudflare D1.\n\n## Steps\n- Install: drizzle-orm, drizzle-kit, nanoid\n- Create D1 database: npx wrangler d1 create giftlist-db\n- Add D1 binding to wrangler.jsonc\n- Create src/db/schema.ts with users and items tables\n- Create drizzle.config.ts for D1\n- Create src/lib/db.ts for db connection helper\n\n## Schema\n```typescript\n// users table\nid: text().primaryKey()  // nanoid\nclerkId: text().notNull().unique()\nemail: text().notNull()\nname: text()\navatarUrl: text()\ncreatedAt: integer({ mode: 'timestamp_ms' })\nupdatedAt: integer({ mode: 'timestamp_ms' })\n\n// items table\nid: text().primaryKey()  // nanoid\nownerId: text().notNull().references(() =\u003e users.id)\nname: text().notNull()\nurl: text()\nprice: integer()  // cents to avoid float issues\nnotes: text()\nimageUrl: text()\ncreatedAt: integer({ mode: 'timestamp_ms' })\nupdatedAt: integer({ mode: 'timestamp_ms' })\n```\n\n## Files\n- src/db/schema.ts (create)\n- src/lib/db.ts (create)\n- drizzle.config.ts (create)\n- wrangler.jsonc (modify - add D1 binding)\n- package.json (add dependencies)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:21:02.03241-08:00","created_by":"alex","updated_at":"2025-12-29T20:36:25.862195-08:00","closed_at":"2025-12-29T20:36:25.862195-08:00","close_reason":"Completed database foundation setup: installed drizzle-orm, drizzle-kit, nanoid; created src/db/schema.ts with users and items tables; created drizzle.config.ts; created src/lib/db.ts; added D1 binding to wrangler.jsonc; added db scripts. User must run wrangler d1 create giftlist-db interactively.","dependencies":[{"issue_id":"giftlist-5d3","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.052673-08:00","created_by":"daemon"}]}
{"id":"giftlist-5li","title":"Create Clerk Application","description":"Set up Clerk project and get credentials.\n\n## Steps\n- Go to clerk.com and create new application\n- Choose authentication methods (email, Google, etc.)\n- Copy API keys for local development\n- Note the webhook signing secret for later\n\n## Output needed\n- PUBLIC_CLERK_PUBLISHABLE_KEY\n- CLERK_SECRET_KEY\n- Webhook endpoint URL pattern\n\n## Dependencies\nNone - this is the first task","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:20:57.310376-08:00","created_by":"alex","updated_at":"2025-12-29T20:37:29.220175-08:00","closed_at":"2025-12-29T20:37:29.220175-08:00","close_reason":"Clerk application created with email+Google auth. API keys stored in .dev.vars. Created .dev.vars.example template for documentation.","dependencies":[{"issue_id":"giftlist-5li","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.024932-08:00","created_by":"daemon"}]}
{"id":"giftlist-6dc","title":"Add/Edit Item Dialog","description":"Form for creating and editing items.\n\n## Steps\n- Add shadcn components: Dialog, Input, Label, Textarea\n- Form fields: name (required), url, price, notes\n- Client-side validation matching API schemas\n- Submit to API endpoints\n- Optimistic updates or refetch on success\n- Loading and error states\n- Install TanStack Query for data fetching\n\n## Files\n- src/components/ui/dialog.tsx (add via shadcn)\n- src/components/ui/input.tsx (add via shadcn)\n- src/components/ui/label.tsx (add via shadcn)\n- src/components/ui/textarea.tsx (add via shadcn)\n- src/components/ItemFormDialog.tsx (create)\n- src/lib/api.ts (create - API client helpers)\n- src/hooks/useItems.ts (create - TanStack Query hooks)\n\n## Dependencies\n- Requires: Item Card Component, Items API Endpoints","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:22:05.3667-08:00","created_by":"alex","updated_at":"2025-12-29T20:22:05.3667-08:00","dependencies":[{"issue_id":"giftlist-6dc","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.296157-08:00","created_by":"daemon"},{"issue_id":"giftlist-6dc","depends_on_id":"giftlist-y6h","type":"blocks","created_at":"2025-12-29T20:22:55.606809-08:00","created_by":"daemon"}]}
{"id":"giftlist-b03","title":"Wishlist Page","description":"Main page displaying user's items.\n\n## Steps\n- Create /wishlist route (protected)\n- Redirect to sign-in if not authenticated (use auth adapter)\n- Fetch items server-side in Astro\n- Pass items to React island for interactivity\n- Empty state component when no items\n- Add Item button in header or empty state\n\n## Files\n- src/pages/wishlist.astro (create)\n- src/components/WishlistPage.tsx (create - React island)\n- src/components/EmptyState.tsx (create)\n\n## Dependencies\n- Requires: App Layout \u0026 Navigation, Items API Endpoints","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:22:01.559041-08:00","created_by":"alex","updated_at":"2025-12-29T20:22:01.559041-08:00","dependencies":[{"issue_id":"giftlist-b03","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.24657-08:00","created_by":"daemon"},{"issue_id":"giftlist-b03","depends_on_id":"giftlist-jk8","type":"blocks","created_at":"2025-12-29T20:22:55.526811-08:00","created_by":"daemon"},{"issue_id":"giftlist-b03","depends_on_id":"giftlist-bcr","type":"blocks","created_at":"2025-12-29T20:22:55.554046-08:00","created_by":"daemon"}]}
{"id":"giftlist-bcr","title":"Items API Endpoints","description":"CRUD API for wishlist items.\n\n## Endpoints\n- GET /api/items - list current user's items\n- POST /api/items - create new item\n- PUT /api/items/[id] - update item (owner only)\n- DELETE /api/items/[id] - delete item (owner only)\n\n## Steps\n- Install zod for validation\n- All endpoints use auth adapter for user context\n- Return proper HTTP status codes and JSON responses\n\n## Files\n- src/pages/api/items/index.ts (create - GET, POST)\n- src/pages/api/items/[id].ts (create - PUT, DELETE)\n- src/lib/validations/item.ts (create - Zod schemas)\n\n## Dependencies\n- Requires: Database Migration, Clerk Integration","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T20:21:43.672092-08:00","created_by":"alex","updated_at":"2025-12-29T20:21:43.672092-08:00","dependencies":[{"issue_id":"giftlist-bcr","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.216631-08:00","created_by":"daemon"},{"issue_id":"giftlist-bcr","depends_on_id":"giftlist-vfk","type":"blocks","created_at":"2025-12-29T20:22:55.469249-08:00","created_by":"daemon"},{"issue_id":"giftlist-bcr","depends_on_id":"giftlist-hvy","type":"blocks","created_at":"2025-12-29T20:22:55.493981-08:00","created_by":"daemon"}]}
{"id":"giftlist-hvy","title":"Clerk Integration","description":"Implement Clerk adapter and integrate with Astro.\n\n## Steps\n- Install @clerk/astro\n- Add Clerk integration to astro.config.mjs\n- Create src/middleware.ts using auth adapter\n- Add environment variables to .env\n- Update src/env.d.ts with types\n- Enable SSR output mode\n\n## Environment Variables (.env)\n```\nPUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...\nCLERK_SECRET_KEY=sk_test_...\n```\n\n## Files\n- astro.config.mjs (modify - add clerk(), output: 'server')\n- src/middleware.ts (create - uses auth adapter)\n- .env (create/modify)\n- src/env.d.ts (modify - add App.Locals types)\n\n## Dependencies\n- Requires: Auth Adapter Pattern, Clerk Application credentials","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-29T20:21:30.417406-08:00","created_by":"alex","updated_at":"2025-12-29T20:21:30.417406-08:00","dependencies":[{"issue_id":"giftlist-hvy","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.131206-08:00","created_by":"daemon"},{"issue_id":"giftlist-hvy","depends_on_id":"giftlist-naz","type":"blocks","created_at":"2025-12-29T20:22:55.365001-08:00","created_by":"daemon"}]}
{"id":"giftlist-jk8","title":"App Layout \u0026 Navigation","description":"Create authenticated app shell.\n\n## Steps\n- Modify existing src/layouts/Layout.astro or create new AppLayout\n- Add Header component (use Clerk components via adapter abstraction)\n- Add UserButton for profile/logout\n- Style navigation with TailwindCSS\n- Note: Clerk UI components used here; future auth swap may need UI updates\n\n## Files\n- src/layouts/AppLayout.astro (create)\n- src/components/Header.astro (create)\n\n## Dependencies\n- Requires: Clerk Integration","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:21:40.743165-08:00","created_by":"alex","updated_at":"2025-12-29T20:21:40.743165-08:00","dependencies":[{"issue_id":"giftlist-jk8","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.187611-08:00","created_by":"daemon"},{"issue_id":"giftlist-jk8","depends_on_id":"giftlist-hvy","type":"blocks","created_at":"2025-12-29T20:22:55.44399-08:00","created_by":"daemon"}]}
{"id":"giftlist-naz","title":"Auth Adapter Pattern","description":"Create abstraction layer for authentication to enable future provider swaps.\n\n## Interface Design\n```typescript\n// src/lib/auth/types.ts\ninterface AuthUser {\n  id: string           // Our internal user ID\n  providerId: string   // Provider's user ID (e.g., Clerk ID)\n  email: string\n  name: string | null\n  avatarUrl: string | null\n}\n\ninterface AuthAdapter {\n  // Server-side\n  getCurrentUser(request: Request, locals: App.Locals): Promise\u003cAuthUser | null\u003e\n  getUserById(providerId: string): Promise\u003cAuthUser | null\u003e\n\n  // Webhook verification\n  verifyWebhook(request: Request): Promise\u003cWebhookEvent\u003e\n}\n```\n\n## Steps\n- Create src/lib/auth/types.ts - interfaces\n- Create src/lib/auth/clerk-adapter.ts - Clerk implementation\n- Create src/lib/auth/index.ts - export configured adapter\n- Middleware uses adapter, not Clerk directly\n\n## Files\n- src/lib/auth/types.ts (create)\n- src/lib/auth/clerk-adapter.ts (create)\n- src/lib/auth/index.ts (create)\n\n## Dependencies\n- Requires: Clerk Application credentials","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:21:07.856798-08:00","created_by":"alex","updated_at":"2025-12-29T20:56:13.174763-08:00","closed_at":"2025-12-29T20:56:13.174763-08:00","close_reason":"Created auth adapter pattern with AuthUser/AuthAdapter interfaces in types.ts, ClerkAdapter implementation using @clerk/backend and svix in clerk-adapter.ts, and getAuthAdapter factory in index.ts. Pattern abstracts Clerk auth behind provider-agnostic interface enabling future auth provider swaps.","dependencies":[{"issue_id":"giftlist-naz","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.103655-08:00","created_by":"daemon"},{"issue_id":"giftlist-naz","depends_on_id":"giftlist-5li","type":"blocks","created_at":"2025-12-29T20:22:55.335061-08:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"giftlist-naz","author":"alex","text":"Clerk credentials ready in .dev.vars: CLERK_SECRET_KEY, PUBLIC_CLERK_PUBLISHABLE_KEY. See .dev.vars.example for template. Implement ClerkAdapter using @clerk/backend package. Reference schema: users table has clerkId field for provider mapping.","created_at":"2025-12-30T04:47:16Z"},{"id":4,"issue_id":"giftlist-naz","author":"alex","text":"Research: Use @clerk/astro for frontend + @clerk/backend for server ops. Middleware pattern: authMiddleware from @clerk/astro/middleware with publicRoutes array. getAuth pattern: access via Astro.locals.auth() in SSR pages/endpoints. For webhooks: use svix package to verify signatures with CLERK_WEBHOOK_SECRET. All code runs in workerd - avoid Node.js-only APIs.","created_at":"2025-12-30T04:50:20Z"}]}
{"id":"giftlist-vfk","title":"Database Migration","description":"Generate and apply migrations to D1.\n\n## Steps\n- Run npx drizzle-kit generate to create SQL migration files\n- Apply to local D1: npx wrangler d1 migrations apply giftlist-db --local\n- Verify tables created with wrangler d1 execute\n\n## Files\n- drizzle/ directory (generated migrations)\n\n## Dependencies\n- Requires: Database Foundation task","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T20:21:04.482303-08:00","created_by":"alex","updated_at":"2025-12-29T20:56:28.864759-08:00","closed_at":"2025-12-29T20:56:28.864759-08:00","close_reason":"Closed","dependencies":[{"issue_id":"giftlist-vfk","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.078413-08:00","created_by":"daemon"},{"issue_id":"giftlist-vfk","depends_on_id":"giftlist-5d3","type":"blocks","created_at":"2025-12-29T20:22:55.308533-08:00","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"giftlist-vfk","author":"alex","text":"Database ready: D1 database 'giftlist-db' created (ID: afc6a33a-de69-465e-8f69-916cf8e71c85). Schema at src/db/schema.ts with users+items tables. Config at drizzle.config.ts. Binding 'DB' in wrangler.jsonc. Run: npx drizzle-kit generate \u0026\u0026 npx wrangler d1 migrations apply giftlist-db --local","created_at":"2025-12-30T04:47:13Z"},{"id":3,"issue_id":"giftlist-vfk","author":"alex","text":"Research: Use 'npx drizzle-kit generate' to create SQL in ./drizzle/migrations. Apply local: 'npx wrangler d1 migrations apply DB --local'. Config needs migrations_dir in wrangler.jsonc. Test locally first before remote. Avoid 'drizzle-kit push' in prod - use generate+apply for trackable changes.","created_at":"2025-12-30T04:50:16Z"}]}
{"id":"giftlist-y6h","title":"Item Card Component","description":"Display individual wishlist items.\n\n## Steps\n- Add shadcn Card component: npx shadcn@latest add card\n- Show: name, price (formatted), external link, notes preview\n- Image placeholder (gray box, no upload yet)\n- Edit and Delete action buttons (icons)\n- Hover states and responsive design\n\n## Files\n- src/components/ui/card.tsx (add via shadcn)\n- src/components/ItemCard.tsx (create)\n\n## Dependencies\n- Requires: Wishlist Page","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T20:22:03.163367-08:00","created_by":"alex","updated_at":"2025-12-29T20:22:03.163367-08:00","dependencies":[{"issue_id":"giftlist-y6h","depends_on_id":"giftlist-4bn","type":"parent-child","created_at":"2025-12-29T20:22:39.271542-08:00","created_by":"daemon"},{"issue_id":"giftlist-y6h","depends_on_id":"giftlist-b03","type":"blocks","created_at":"2025-12-29T20:22:55.581605-08:00","created_by":"daemon"}]}
